import os
import sys
import subprocess
from urlparse import urlparse


class Utility:

    COLORS = {
        'HEADER': '\033[95m',
        'OKBLUE': '\033[94m',
        'OKGREEN': '\033[92m',
        'WARNING': '\033[93m',
        'FAIL': '\033[91m',
        'ENDC': '\033[0m',
        'BOLD': '\033[1m',
        'UNDERLINE': '\033[4m',
    }

    def cprint(self, text, color, hr=False, tabbed=True):

        tab = (" " * 8) if tabbed else ''
        print (tab + self.COLORS.get(color) + text + self.COLORS.get('ENDC'))
        if hr:
            self.hr()

    def cls(self):
        # Clear the screen
        subprocess.call('clear', shell=True)

    def kill(self):
        sys.exit()

    def hr(self, tabbed=True):
        # Clear the screen
        tab = (" " * 8) if tabbed else ''
        padding = '' if tabbed else ("-" * 8)
        print (tab + "-" * 70 + padding)

    def host_from_url(self, url):
        parsed_uri = urlparse(url)
        #return '{uri.scheme}://{uri.netloc}'.format(uri=parsed_uri)
        return '{uri.netloc}'.format(uri=parsed_uri)

    def path_from_url(self, url):
        parsed_uri = urlparse(url)
        url = '{uri.path}'.format(uri=parsed_uri)
        # We remove the trailing slashes from the path to make it more manageable in re-creating urls
        return url.strip("/")

    def show_splash_screen(self):
        self.cprint(
            ' ______________________________________________________________________', 'OKGREEN')
        self.cprint(
            '|                                                                      |', 'OKGREEN')
        self.cprint(
            '|                     Ethical Exploiting Script                        |', 'OKGREEN')
        self.cprint(
            '|                           Irfan Mehmood                              |', 'OKGREEN')
        self.cprint(
            '|                                                                      |', 'OKGREEN')
        self.cprint(
            '------------------------------------------------------------------------', 'OKGREEN')
        print
        print

    def show_select_menu(self):
        self.cprint('1. CREATE JOB (FROM CONFIG) / RESTART JOB (FROM DB).', 'WARNING')
        print
        self.cprint('2. CLEAR DATABASE. THEN USE (1. STEP TO CREATE JOB)', 'WARNING')
        print

    def cprint_show_job(self, JOB):
        JOB_ID = str(JOB['_id'])
        SCAN_ROOT_URL = str(JOB['job_url'])
        self.cprint('JOB EXIST: IN QUEUE', 'WARNING', False, False)
        self.cprint('JOB ID: ' + JOB_ID, 'WARNING', False, False)
        self.cprint('SCAN URL: ' + SCAN_ROOT_URL, 'WARNING', False, False)
        self.hr(False)